import{_ as F,c as x,o as c,h as n,f as t,b as l,d,F as T,e as u,E as m,w as C,g as r,p as V,t as U,m as D,a as S,j as N}from"./index-CeHthxjz.js";const j={created(){var e=new URLSearchParams(window.location.search).get("id");this.setting.houseId=e,u.post("/house/getHouseById/"+e).then(i=>{i.data.status==200&&(this.house=i.data.data)}),u.post("/house/getBranch/"+e).then(i=>{i.data.status==200&&(this.branches=i.data.data)}),u.post("/right/getUser/"+e).then(i=>{i.data.status==200?this.collaborators=i.data.data:m.error(i.data.message)}),u.post("/branch/getBranchRule/"+e).then(i=>{i.data.status==200&&(this.branchRule=i.data.data)})},data(){return{rigtVis:!1,selectedRight:{},infovis:!1,showHouseRight:{},setting:{right:"R",username:"",branch:"",houseId:-1},activeTab:"general",vis:!1,house:{name:"",description:"",visibility:"public",defaultBranch:"main"},branches:["main","dev"],collaborators:["user1","user2"],newCollaborator:"",saving:!1,isOwner:!0,branchRule:[]}},methods:{deleteBranch(o){this.$confirm(`确定要删除分支 "${o}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.post("/branch/deleteBranch",{houseId:this.setting.houseId,branchName:o.name}).then(e=>{e.data.status==200&&(this.branchRule=this.branchRule.filter(i=>i!==o),this.$message.success("已删除"))})}).catch(()=>{this.$message.info("已取消删除")})},protectBranch(o){o.rule!="R"?this.$confirm(`确定要保护分支 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(()=>{u.post("/branch/add",{houseId:this.setting.houseId,rule:"R",branchName:o.name}).then(e=>{e.data.status==200&&(o.rule="R",this.$message.success("成功"))})}).catch(()=>{this.$message.info("成功")}):this.$confirm(`确定解除保护分支 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(()=>{u.post("/branch/deleteBranchRule",{houseId:this.setting.houseId,branchName:o.name}).then(e=>{e.data.status==200&&(o.rule="none",this.$message.success("成功"))})}).catch(()=>{this.$message.info("成功")})},confirmChange(){u.post("/right/changeRight",{id:this.showHouseRight.id,rights:JSON.stringify(this.showHouseRight.rights)}).then(o=>{o.data.status==200?location.reload():m.error(o.data.message)})},deleteRights(o){this.showHouseRight.rights=this.showHouseRight.rights.filter(e=>e!==o),u.post("/right/changeRight",{id:this.showHouseRight.id,rights:JSON.stringify(this.showHouseRight.rights)}).then(e=>{e.data.status==200?location.reload():m.error(e.data.message)})},changeRights(o){this.rigtVis=!0,this.selectedRight=o},showCollaborator(o){this.infovis=!0;var i=new URLSearchParams(window.location.search).get("id");u.post("/right/getUserDetail/"+i+"/"+o.id).then(_=>{_.data.status==200?(this.showHouseRight=_.data.data,this.showHouseRight.rights=JSON.parse(this.showHouseRight.rights)):m.error(_.data.message)})},sureCollaborator(){u.post("/right/addUser",this.setting).then(o=>{o.data.status==200?(m.success("成功"),location.reload()):m.error(o.data.message)})},handleMenuSelect(o){this.activeTab=o},saveSettings(){this.saving=!0,u.post("/house/changeType",{id:this.house.id,kind:this.house.kind,name:this.house.name,des:this.house.description}).then(o=>{o.data.status==200?setTimeout(()=>{this.saving=!1,this.$message.success("设置保存成功"),location.reload()},1e3):m.error(o.data.message)})},addCollaborator(){this.vis=!0},removeCollaborator(o){this.$confirm("此操作将删除协作者，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{u.post("/right/deleteUser/"+o.id+"/"+this.setting.houseId).then(e=>{e.data.status==200?(m.success("成功"),location.reload()):m.error(e.data.message)})})},deleteRepository(){this.$confirm("此操作将永久删除仓库，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{var e=new URLSearchParams(window.location.search).get("id");u.post("/house/deleteRep/"+e).then(i=>{i.data.status==200?(m.success("删除成功"),location.href="/"):m.error(i.data.message)})})}}},q={class:"settings-container"},A={class:"collaborators"},G={class:"add-collaborator",style:{float:"left"}},K={class:"danger-item"},Q={slot:"footer",class:"dialog-footer"};function X(o,e,i,_,a,h){const R=d("el-menu-item"),L=d("el-menu"),H=d("el-col"),y=d("el-input"),p=d("el-form-item"),f=d("el-radio"),k=d("el-radio-group"),g=d("el-button"),I=d("el-form"),w=d("el-card"),b=d("el-table-column"),W=d("el-table"),O=d("el-tag"),z=d("el-divider"),E=d("el-popconfirm"),J=d("el-row"),P=d("el-option"),M=d("el-select"),B=d("el-dialog");return c(),x(T,null,[n("div",q,[t(J,{gutter:20},{default:l(()=>[t(H,{span:4},{default:l(()=>[t(L,{"default-active":a.activeTab,class:"settings-menu",onSelect:h.handleMenuSelect},{default:l(()=>[t(R,{index:"general"},{default:l(()=>e[11]||(e[11]=[n("i",{class:"el-icon-setting"},null,-1),n("span",null,"基础设置",-1)])),_:1}),t(R,{index:"branches"},{default:l(()=>e[12]||(e[12]=[n("i",{class:"el-icon-folder-opened"},null,-1),n("span",null,"分支设置",-1)])),_:1}),t(R,{index:"collaborators"},{default:l(()=>e[13]||(e[13]=[n("i",{class:"el-icon-user"},null,-1),n("span",null,"协作者",-1)])),_:1}),t(R,{index:"danger"},{default:l(()=>e[14]||(e[14]=[n("i",{class:"el-icon-warning"},null,-1),n("span",null,"危险操作",-1)])),_:1})]),_:1},8,["default-active","onSelect"])]),_:1}),t(H,{span:20},{default:l(()=>[C(t(w,{class:"settings-card"},{default:l(()=>[e[18]||(e[18]=n("div",{slot:"header"},[n("span",null,"基础设置")],-1)),t(I,{model:a.house,"label-width":"120px"},{default:l(()=>[t(p,{label:"名称"},{default:l(()=>[t(y,{modelValue:a.house.name,"onUpdate:modelValue":e[0]||(e[0]=s=>a.house.name=s),placeholder:"名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"描述"},{default:l(()=>[t(y,{modelValue:a.house.description,"onUpdate:modelValue":e[1]||(e[1]=s=>a.house.description=s),type:"textarea",rows:3,placeholder:"描述"},null,8,["modelValue"])]),_:1}),t(p,{label:"可见性"},{default:l(()=>[t(k,{modelValue:a.house.kind,"onUpdate:modelValue":e[2]||(e[2]=s=>a.house.kind=s)},{default:l(()=>[t(f,{label:0,value:0},{default:l(()=>e[15]||(e[15]=[r("Public")])),_:1}),t(f,{label:1,value:1},{default:l(()=>e[16]||(e[16]=[r("Private")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(g,{type:"primary",loading:a.saving,onClick:h.saveSettings},{default:l(()=>e[17]||(e[17]=[r(" 确认修改 ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model"])]),_:1},512),[[V,a.activeTab==="general"]]),C(t(w,{class:"settings-card"},{default:l(()=>[e[20]||(e[20]=n("div",{slot:"header"},[n("span",null,"分支管理")],-1)),t(W,{data:a.branchRule,style:{width:"100%"}},{default:l(()=>[t(b,{label:"分支名称",width:"200"},{default:l(s=>[n("div",null,U(s.row.name),1)]),_:1}),t(b,{label:"操作",width:"200"},{default:l(s=>[t(g,{size:"small",onClick:v=>h.protectBranch(s.row)},{default:l(()=>[r(U(s.row.rule!="R"?"保护分支":"解除保护"),1)]),_:2},1032,["onClick"]),t(g,{size:"small",type:"danger",onClick:v=>h.deleteBranch(s.row)},{default:l(()=>e[19]||(e[19]=[r("删除分支")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},512),[[V,a.activeTab==="branches"]]),C(t(w,{class:"settings-card"},{default:l(()=>[e[22]||(e[22]=n("div",{slot:"header"},[n("span",null,"协作者管理")],-1)),n("div",A,[n("div",null,[(c(!0),x(T,null,D(a.collaborators,s=>(c(),S(O,{key:s.id,closable:"",onClose:v=>h.removeCollaborator(s),onClick:v=>h.showCollaborator(s)},{default:l(()=>[r(U(s.name),1)]),_:2},1032,["onClose","onClick"]))),128))]),t(z),n("div",G,[t(g,{type:"primary",icon:"el-icon-plus",onClick:h.addCollaborator},{default:l(()=>e[21]||(e[21]=[r("授权")])),_:1},8,["onClick"])])])]),_:1},512),[[V,a.activeTab==="collaborators"]]),C(t(w,{class:"danger-zone"},{default:l(()=>[e[25]||(e[25]=n("div",{slot:"header"},[n("span",{class:"danger-title"},"危险区域")],-1)),n("div",K,[t(g,{type:"danger",onClick:h.deleteRepository},{default:l(()=>e[23]||(e[23]=[r("Delete Repository")])),_:1},8,["onClick"]),e[24]||(e[24]=n("p",null,"This action cannot be undone...",-1)),t(E,{title:"确认删除仓库吗？",onConfirm:h.deleteRepository},null,8,["onConfirm"])])]),_:1},512),[[V,a.activeTab==="danger"]])]),_:1})]),_:1})]),t(B,{modelValue:a.vis,"onUpdate:modelValue":e[6]||(e[6]=s=>a.vis=s)},{default:l(()=>[t(I,{"label-width":"120px"},{default:l(()=>[t(p,{label:"用户名"},{default:l(()=>[t(y,{modelValue:a.setting.username,"onUpdate:modelValue":e[3]||(e[3]=s=>a.setting.username=s),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),a.setting.right!="C"?(c(),S(p,{key:0,label:"授权分支"},{default:l(()=>[t(M,{modelValue:a.setting.branch,"onUpdate:modelValue":e[4]||(e[4]=s=>a.setting.branch=s)},{default:l(()=>[t(P,{label:"all",value:"all"}),(c(!0),x(T,null,D(a.branches,s=>(c(),S(P,{label:s,value:s},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):N("",!0),t(p,{label:"权限"},{default:l(()=>[t(k,{modelValue:a.setting.right,"onUpdate:modelValue":e[5]||(e[5]=s=>a.setting.right=s)},{default:l(()=>[t(f,{value:"RW+"},{default:l(()=>e[26]||(e[26]=[r("RW+")])),_:1}),t(f,{value:"RW"},{default:l(()=>e[27]||(e[27]=[r("RW")])),_:1}),t(f,{value:"R"},{default:l(()=>e[28]||(e[28]=[r("R")])),_:1}),t(f,{value:"C"},{default:l(()=>e[29]||(e[29]=[r("Create")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(g,{type:"primary",onClick:h.sureCollaborator},{default:l(()=>e[30]||(e[30]=[r(" 确认 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:a.infovis,"onUpdate:modelValue":e[7]||(e[7]=s=>a.infovis=s)},{default:l(()=>[t(W,{data:a.showHouseRight.rights,style:{width:"100%"}},{default:l(()=>[t(b,{prop:"branch",label:"分支",width:"180"}),t(b,{prop:"right",label:"权限",width:"180"}),t(b,{label:"操作",width:"180"},{default:l(s=>[t(g,{onClick:v=>h.deleteRights(s.row),type:"warning"},{default:l(()=>e[31]||(e[31]=[r("删除")])),_:2},1032,["onClick"]),t(g,{onClick:v=>h.changeRights(s.row),type:"primary"},{default:l(()=>e[32]||(e[32]=[r("修改")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(B,{title:"修改权限",modelValue:a.rigtVis,"onUpdate:modelValue":e[10]||(e[10]=s=>a.rigtVis=s),width:"30%"},{default:l(()=>[t(k,{modelValue:a.selectedRight.right,"onUpdate:modelValue":e[8]||(e[8]=s=>a.selectedRight.right=s)},{default:l(()=>[t(f,{label:"RW+"},{default:l(()=>e[33]||(e[33]=[r("RW+")])),_:1}),t(f,{label:"RW"},{default:l(()=>e[34]||(e[34]=[r("RW")])),_:1}),t(f,{label:"R"},{default:l(()=>e[35]||(e[35]=[r("R")])),_:1})]),_:1},8,["modelValue"]),n("div",Q,[t(g,{onClick:e[9]||(e[9]=s=>a.rigtVis=!1)},{default:l(()=>e[36]||(e[36]=[r("取消")])),_:1}),t(g,{type:"primary",onClick:h.confirmChange},{default:l(()=>e[37]||(e[37]=[r("确定")])),_:1},8,["onClick"])])]),_:1},8,["modelValue"])],64)}const Z=F(j,[["render",X],["__scopeId","data-v-2f76ea94"]]);export{Z as default};
