import{_ as y,c as u,o as r,f as c,j as R,h as t,b as h,d as p,w as C,v as B,i as I,t as o,F as m,m as _,e as d,E as f,g as b,a as V,n as k}from"./index-CeHthxjz.js";const S={created(){var e=new URLSearchParams(window.location.search).get("id");this.houseId=e,d.post("/house/getBranch/"+e).then(n=>{n.data.status==200&&(this.branches=n.data.data)}),d.post("/pull/get/"+this.houseId).then(n=>{n.data.status==200&&(this.prs=n.data.data)}),d.post("/house/getHouseById/"+this.houseId).then(n=>{n.data.status==200&&(this.house=n.data.data)})},data(){return{isFormVisible:!1,user:JSON.parse(localStorage.getItem("user")).user,houseId:-1,branches:[],newPR:{title:"",description:"",baseBranch:"",headBranch:""},prs:[],states:[-1,0,1,2,3],currentFilter:"all",nextId:1,house:{}}},computed:{filteredPRs(){return this.prs.filter(l=>this.currentFilter===-1||l.state===this.currentFilter)},stateCounts(){return this.states.reduce((l,e)=>(l[e]=e==-1?this.prs.length:this.prs.filter(n=>n.state===e).length,l),{})}},methods:{getStatus(l){return l==0?"创建":l==1?"已同意":l==2?"已合并":l==3?"已关闭":l==-1?"全部":"none"},createPR(){d.post("/pull/add",{...this.newPR,houseId:this.houseId,username:this.user.name}).then(l=>{l.data.status==200&&(f.success("成功"),location.reload())})},toggleDetails(l){const e=this.prs.find(n=>n.id===l);e&&(e.showDetails=!e.showDetails)},addComment(l){const e=this.prs.find(n=>n.id===l);e&&e.newComment.trim()&&(e.comments.push({id:e.comments.length+1,author:"Current User",text:e.newComment}),e.newComment="")},mergePR(l){const e=this.prs.find(n=>n.id===l);e&&(e.state=2,d.post("/pull/update",e).then(n=>{n.data.status==200&&f.success("成功")}))},closePR(l){const e=this.prs.find(n=>n.id===l);e&&(e.state=3,d.post("/pull/update",e).then(n=>{n.data.status==200&&f.success("成功")}))},sure(l){const e=this.prs.find(n=>n.id===l);e&&(e.state=1,d.post("/pull/update",e).then(n=>{n.data.status==200&&f.success("成功")}))}}},q={class:"pr-system"},D={key:0,class:"create-pr"},N={class:"form-group"},U={class:"form-group"},E={class:"form-group"},T={class:"form-group"},z={class:"pr-list"},M={class:"filters"},H=["onClick"],L={class:"pr-header"},j={class:"pr-title"},A={class:"pr-number"},J={class:"pr-state",style:{color:"#8EF3FA"}},O={class:"pr-body"},G={class:"pr-meta"},K={class:"author"},Q={class:"branch"},W={class:"branch"},X={key:0,class:"pr-actions"},Y=["onClick"],Z=["onClick"],$=["onClick"],ee={class:"pr-details"},se={class:"pr-description"},te={class:"pr-description",style:{"font-size":"xx-small"}};function ne(l,e,n,le,i,a){const x=p("el-button"),v=p("el-option"),g=p("el-select"),F=p("el-space");return r(),u("div",q,[c(x,{onClick:e[0]||(e[0]=()=>{this.isFormVisible=!this.isFormVisible}),class:"toggle-btn"},{default:h(()=>[b(o(i.isFormVisible?"hidden":"add pull"),1)]),_:1}),i.isFormVisible?(r(),u("div",D,[e[11]||(e[11]=t("h2",null,"Create New Pull Request",-1)),t("form",{onSubmit:e[5]||(e[5]=I((...s)=>a.createPR&&a.createPR(...s),["prevent"]))},[t("div",N,[e[6]||(e[6]=t("label",null,"Title:",-1)),C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.newPR.title=s),required:""},null,512),[[B,i.newPR.title]])]),t("div",U,[e[7]||(e[7]=t("label",null,"Description:",-1)),C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.newPR.description=s),required:""},null,512),[[B,i.newPR.description]])]),t("div",E,[e[8]||(e[8]=t("label",null,"Base Branch:",-1)),c(g,{modelValue:i.newPR.baseBranch,"onUpdate:modelValue":e[3]||(e[3]=s=>i.newPR.baseBranch=s),required:"",style:{width:"200px"}},{default:h(()=>[(r(!0),u(m,null,_(i.branches,s=>(r(),V(v,{value:s,label:s},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),t("div",T,[e[9]||(e[9]=t("label",null,"Head Branch:",-1)),c(g,{modelValue:i.newPR.headBranch,"onUpdate:modelValue":e[4]||(e[4]=s=>i.newPR.headBranch=s),required:"",style:{width:"200px"}},{default:h(()=>[(r(!0),u(m,null,_(i.branches,s=>(r(),V(v,{value:s,label:s},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])]),e[10]||(e[10]=t("button",{type:"submit",class:"submit-btn"},"Create Pull Request",-1))],32)])):R("",!0),t("div",z,[t("h2",null,"Pull Requests ("+o(a.filteredPRs.length)+")",1),t("div",M,[(r(!0),u(m,null,_(i.states,s=>(r(),u("button",{key:s,class:k({active:i.currentFilter===s}),onClick:w=>i.currentFilter=s},o(a.getStatus(s))+" ("+o(a.stateCounts[s])+") ",11,H))),128))]),(r(!0),u(m,null,_(a.filteredPRs,(s,w)=>(r(),u("div",{key:s.id,class:k(["pr-item",s.state])},[t("div",L,[t("span",j,o(s.title),1),t("span",A,"#"+o(w+1),1),t("span",J,o(a.getStatus(s.state)),1)]),t("div",O,[t("div",G,[t("span",K,o(s.username),1),e[12]||(e[12]=b(" 想要合并 ")),t("span",Q,o(s.headBranch),1),e[13]||(e[13]=b(" 到 ")),t("span",W,o(s.baseBranch),1)]),i.house.creatorId==i.user.id?(r(),u("div",X,[c(F,{direction:"horizontal"},{default:h(()=>[t("button",{onClick:P=>a.sure(s.id),class:"close-btn"},"同意",8,Y),t("button",{onClick:P=>a.mergePR(s.id),class:"merge-btn"},"已合并",8,Z),t("button",{onClick:P=>a.closePR(s.id),class:"close-btn"},"关闭",8,$)]),_:2},1024)])):R("",!0),t("div",ee,[t("div",se,o(s.description),1),t("div",te,o(s.createTime),1)])])],2))),128))])])}const oe=y(S,[["render",ne],["__scopeId","data-v-6e964626"]]);export{oe as default};
