import{_ as D,c as y,o as p,h as n,f as l,b as s,d as r,F as I,e as b,E as N,g as u,m as v,a as V,j as T,n as z,t as c,L as O}from"./index-CeHthxjz.js";const E={created(){var e=new URLSearchParams(window.location.search).get("id");this.houseId=e,b.post("/house/getBranch/"+e).then(i=>{i.data.status==200&&(this.branches=i.data.data)}),b.post("/issues/get/"+this.houseId).then(i=>{i.data.status==200&&(this.issues=i.data.data)}),b.post("/house/getHouseById/"+this.houseId).then(i=>{i.data.status==200&&(this.house=i.data.data)})},data(){return{house:{},user:JSON.parse(localStorage.getItem("user")).user,houseId:-1,dialogVisible:!1,newIssue:{title:"",description:"",labels:[],state:"open"},rules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}]},issues:[],searchQuery:"",stateFilter:"all",labelFilter:"all",sortBy:"newest"}},computed:{nextNumber(){return this.issues.length>0?Math.max(...this.issues.map(o=>o.number))+1:1e3},allLabels(){return["feature","bug","task","any"]},filteredIssues(){return this.issues.filter(o=>{const e=o.title.toLowerCase().includes(this.searchQuery.toLowerCase()),i=this.stateFilter==="all"||o.state===this.stateFilter,x=this.labelFilter==="all"||o.labels.includes(this.labelFilter);return e&&i&&x}).sort((o,e)=>this.sortBy==="newest"?new Date(e.createTime)-new Date(o.createTime):new Date(o.createTime)-new Date(e.createTime))}},methods:{changeState(o){o.state=="open"?o.state="closed":o.state="open",b.post("/issues/update",o).then(e=>{e.data.status==200&&N.success("成功")})},submitIssue(){this.$refs.issueForm.validate(o=>{if(o){const e={title:this.newIssue.title,state:this.newIssue.state,labels:[...this.newIssue.labels],username:this.user.name,description:this.newIssue.description,houseId:this.houseId};b.post("/issues/add",e).then(i=>{i.data.status==200&&(this.issues.unshift(e),this.dialogVisible=!1,this.$message.success("Issue 创建成功!"),location.reload())})}})},resetForm(){this.$refs.issueForm.resetFields(),this.newIssue.labels=[],this.newIssue.state="open"},formatDate(o){return new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},getLabelColor(o){return{bug:"#d73a4a",feature:"#a2eeef",task:"#7057ff"}[o]||"#cccccc"}}},A={class:"issues-container"},M={style:{"margin-bottom":"20px"}},Q={slot:"footer"},j={class:"issues-container"},q={class:"filters"},H={class:"meta"},J={style:{display:"flex","align-items":"center"}},P={style:{display:"flex","align-items":"center"}},R={style:{display:"flex","align-items":"center"}};function G(o,e,i,x,a,d){const h=r("el-button"),C=r("el-input"),_=r("el-form-item"),m=r("el-option"),g=r("el-select"),F=r("el-radio"),L=r("el-radio-group"),S=r("el-form"),B=r("el-dialog"),f=r("el-table-column"),k=r("el-tag"),U=r("el-table");return p(),y(I,null,[n("div",A,[n("div",M,[l(h,{type:"primary",onClick:e[0]||(e[0]=()=>{a.dialogVisible=!0})},{default:s(()=>e[10]||(e[10]=[n("i",{class:"el-icon-plus"},null,-1),u(" 新建 Issue ")])),_:1})]),l(B,{title:"新建 Issue",modelValue:a.dialogVisible,"onUpdate:modelValue":e[6]||(e[6]=t=>a.dialogVisible=t),width:"600px",onClosed:d.resetForm},{default:s(()=>[l(S,{model:a.newIssue,rules:a.rules,ref:"issueForm","label-width":"100px"},{default:s(()=>[l(_,{label:"标题",prop:"title"},{default:s(()=>[l(C,{modelValue:a.newIssue.title,"onUpdate:modelValue":e[1]||(e[1]=t=>a.newIssue.title=t),placeholder:"请输入标题",clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"描述"},{default:s(()=>[l(C,{type:"textarea",rows:4,modelValue:a.newIssue.description,"onUpdate:modelValue":e[2]||(e[2]=t=>a.newIssue.description=t),placeholder:"请输入详细描述"},null,8,["modelValue"])]),_:1}),l(_,{label:"标签"},{default:s(()=>[l(g,{modelValue:a.newIssue.labels,"onUpdate:modelValue":e[3]||(e[3]=t=>a.newIssue.labels=t),multiple:"",style:{width:"100%"},placeholder:"选择标签"},{default:s(()=>[(p(!0),y(I,null,v(d.allLabels,t=>(p(),V(m,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"状态"},{default:s(()=>[l(L,{modelValue:a.newIssue.state,"onUpdate:modelValue":e[4]||(e[4]=t=>a.newIssue.state=t)},{default:s(()=>[l(F,{label:"open"},{default:s(()=>e[11]||(e[11]=[u("Open")])),_:1}),l(F,{label:"closed"},{default:s(()=>e[12]||(e[12]=[u("Closed")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),n("span",Q,[l(h,{onClick:e[5]||(e[5]=t=>a.dialogVisible=!1)},{default:s(()=>e[13]||(e[13]=[u("取消")])),_:1}),l(h,{type:"primary",onClick:d.submitIssue},{default:s(()=>e[14]||(e[14]=[u("提交")])),_:1},8,["onClick"])])]),_:1},8,["modelValue","onClosed"])]),n("div",j,[n("div",q,[l(g,{modelValue:a.stateFilter,"onUpdate:modelValue":e[7]||(e[7]=t=>a.stateFilter=t),placeholder:"State",style:{"margin-right":"10px"}},{default:s(()=>[l(m,{label:"All",value:"all"}),l(m,{label:"Open",value:"open"}),l(m,{label:"Closed",value:"closed"})]),_:1},8,["modelValue"]),l(g,{modelValue:a.labelFilter,"onUpdate:modelValue":e[8]||(e[8]=t=>a.labelFilter=t),placeholder:"Label",style:{"margin-right":"10px"}},{default:s(()=>[l(m,{label:"All",value:"all"}),(p(!0),y(I,null,v(d.allLabels,t=>(p(),V(m,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(g,{modelValue:a.sortBy,"onUpdate:modelValue":e[9]||(e[9]=t=>a.sortBy=t),placeholder:"Sort by"},{default:s(()=>[l(m,{label:"Newest",value:"newest"}),l(m,{label:"Oldest",value:"oldest"})]),_:1},8,["modelValue"])]),l(U,{data:d.filteredIssues,style:{"margin-top":"20px"}},{default:s(()=>[l(f,{label:"",width:"50"},{default:s(t=>[n("span",{class:z(["state-dot",t.row.state]),style:{display:"inline-block",width:"12px",height:"12px","border-radius":"50%"}},null,2)]),_:1}),l(f,{label:"Title"},{default:s(t=>[n("div",null,[u(c(t.row.title)+" ",1),(p(!0),y(I,null,v(t.row.labels,w=>(p(),V(k,{key:w,style:O([{backgroundColor:d.getLabelColor(w),color:"#fff"},{"margin-left":"8px"}]),size:"small"},{default:s(()=>[u(c(w),1)]),_:2},1032,["style"]))),128))]),n("div",H," #"+c(t.row.number)+" opened "+c(d.formatDate(t.row.createTime))+" by "+c(t.row.username),1)]),_:1}),l(f,{label:"state"},{default:s(t=>[n("div",J,[e[15]||(e[15]=n("i",{class:"el-icon-chat-dot-round",style:{"margin-right":"4px"}},null,-1)),n("div",null,[l(k,null,{default:s(()=>[u(c(t.row.state),1)]),_:2},1024)])])]),_:1}),l(f,{label:"content",width:"120"},{default:s(t=>[n("div",P,[e[16]||(e[16]=n("i",{class:"el-icon-chat-dot-round",style:{"margin-right":"4px"}},null,-1)),n("div",null,c(t.row.description),1)])]),_:1}),a.user.id==a.house.creatorId?(p(),V(f,{key:0,label:"operation"},{default:s(t=>[n("div",R,[l(h,{size:"small",type:"info",onClick:w=>d.changeState(t.row)},{default:s(()=>[u(c(t.row.state=="open"?"close":"open"),1)]),_:2},1032,["onClick"])])]),_:1})):T("",!0)]),_:1},8,["data"])])],64)}const W=D(E,[["render",G],["__scopeId","data-v-d9b7169d"]]);export{W as default};
